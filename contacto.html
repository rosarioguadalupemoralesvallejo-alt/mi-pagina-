<<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contacto - CHARO</title>
  <link rel="stylesheet" href="style.css">
  <style>
    iframe { border: 0; width: 100%; height: 300px; border-radius: 10px; margin-top: 10px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #a0002d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">ğŸ° CHARO</div>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="contacto.html" class="active">Contacto</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Haz tu pedido</h1>
    <h3>El costo adicional por envÃ­o se calcularÃ¡ segÃºn la distancia desde tu ubicaciÃ³n hasta la tienda en Sopachuy, Calle Entre RÃ­os.</h3>

    <h2 id="productoSeleccionado" style="text-align:center; color:#a0002d;"></h2>

    <form action="https://formspree.io/f/xpwyrwnq" method="POST">
      <input type="text" name="nombre" placeholder="Nombre" required>
      <input type="text" name="producto" placeholder="Producto que deseas" required>
      <input type="number" name="cantidad" placeholder="Cantidad" required>

      <!-- ğŸ“ UbicaciÃ³n automÃ¡tica del cliente -->
      <label>Tu ubicaciÃ³n actual (detectada automÃ¡ticamente)</label>
      <input type="text" id="ubicacionCliente" name="ubicacionCliente" placeholder="Detectando ubicaciÃ³n..." readonly>
      <iframe id="mapaCliente" src=""></iframe>

      <!-- ğŸšš Lugar de entrega -->
      <label>Lugar de entrega (donde quieres recibir el producto)</label>
      <input type="text" id="lugarEntrega" name="lugarEntrega" placeholder="Ej: Calle BolÃ­var NÂ°123, Sopachuy" required>

      <!-- ğŸ“ Detalles -->
      <label>Detalles del pedido</label>
      <textarea name="detalles" placeholder="Ej: Entregar a las 5pm, referencias, etc."></textarea>

      <!-- ğŸª Mapa de la tienda -->
      <label>ğŸ“ UbicaciÃ³n de la Tienda CHARO (Sopachuy, Calle Entre RÃ­os)</label>
      <iframe
        src="https://www.google.com/maps?q=-19.49235,-64.47436&hl=es&z=17&output=embed"
        title="UbicaciÃ³n Tienda CHARO - Sopachuy">
      </iframe>

      <button type="submit">Enviar Pedido</button>
    </form>
  </main>

  <script>
    // ğŸ›’ Mostrar producto seleccionado desde la URL
    const params = new URLSearchParams(window.location.search);
    const producto = params.get("producto");
    if (producto) {
      document.querySelector('input[name="producto"]').value = producto;
      document.getElementById("productoSeleccionado").textContent = "ğŸ›’ EstÃ¡s comprando: " + producto;
    }

    // ğŸ“ Detectar ubicaciÃ³n del cliente (por GPS)
    const ubicacionInput = document.getElementById("ubicacionCliente");
    const mapaCliente = document.getElementById("mapaCliente");

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        // Mostrar mapa con ubicaciÃ³n del cliente
        mapaCliente.src = `https://www.google.com/maps?q=${lat},${lon}&hl=es&z=16&output=embed`;

        // Obtener direcciÃ³n con OpenStreetMap
        const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;
        try {
          const res = await fetch(url);
          const data = await res.json();
          const direccion = data.display_name || `Lat: ${lat}, Lon: ${lon}`;
          ubicacionInput.value = direccion + ` (https://www.google.com/maps?q=${lat},${lon})`;
        } catch {
          ubicacionInput.value = `https://www.google.com/maps?q=${lat},${lon}`;
        }
      }, () => {
        ubicacionInput.value = "No se pudo detectar tu ubicaciÃ³n automÃ¡ticamente.";
      });
    } else {
      ubicacionInput.value = "Tu navegador no permite acceder a la ubicaciÃ³n.";
    }

    // ğŸ“± Enviar pedido (Formspree + WhatsApp)
    const form = document.querySelector("form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = new FormData(form);
      const nombre = data.get("nombre");
      const producto = data.get("producto");
      const cantidad = data.get("cantidad");
      const ubicacion = data.get("ubicacionCliente");
      const entrega = data.get("lugarEntrega");
      const detalles = data.get("detalles");

      // Enviar a Formspree
      const response = await fetch(form.action, {
        method: "POST",
        body: data,
        headers: { Accept: "application/json" }
      });

      if (response.ok) {
        // Mensaje de WhatsApp
        const mensaje = `ğŸ° *Nuevo pedido CHARO*\n\nğŸ‘¤ Nombre: ${nombre}\nğŸ“¦ Producto: ${producto}\nğŸ”¢ Cantidad: ${cantidad}\n\nğŸ“ UbicaciÃ³n del cliente: ${ubicacion}\nğŸšš Lugar de entrega: ${entrega}\nğŸ“ Detalles: ${detalles}\n\nğŸª Tienda CHARO: Sopachuy, Calle Entre RÃ­os\nhttps://www.google.com/maps?q=-19.49235,-64.47436`;
        const telefono = "59173466117"; // <-- tu nÃºmero con prefijo de paÃ­s
        const url = `https://api.whatsapp.com/send?phone=${telefono}&text=${encodeURIComponent(mensaje)}`;
        window.open(url, "_blank");

        alert("âœ… Pedido enviado correctamente. Te contactaremos pronto por WhatsApp.");
        form.reset();
      } else {
        alert("âŒ Error al enviar el pedido. Intenta nuevamente.");
      }
    });
  </script>
</body>
</html>
